---
title: "COVID-19 Graphs"
author: "Emma Spors"
date: "9/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, include=TRUE}
library(tidyverse)
library(lubridate)
library(imputeTS)
library(car)
source("covid_functions.r")
```

```{r, echo=FALSE,include=TRUE, results='hide'}
covid_counties <- read_csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv")
covid_states <- read_csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv")

county_population <- read_csv("county_population.csv")
state_population <- read_csv("state_population.csv")
united_states_pop <- read_csv("united_states_pop.csv")

```

```{r}
covidCounties <- covid_rates(covid_counties, county_population)
covidStates <- covid_rates(covid_states, state_population)
covidUs <- us_rates(covid_states, united_states_pop)
```


```{r}
covidCountiesR <- covidCounties %>%
  filter(fips >= 46000 & fips < 47000)
ts_counties <- ggplot(data = covidCountiesR, aes(x = date)) + 
  geom_line(aes(y = cases, color = fips), size = 0.75) + 
  theme_minimal() 
ts_counties
```

```{r}
ts_states <- ggplot(data = covidStates, aes(x = date)) + 
  geom_line(aes(y = cases, color = state.x), size = 0.75) + 
  theme_minimal() 
ts_states
```

```{r}
cumulativeCounties <- cumulative_county(covid_counties, county_population)
cumulativeStates <- cumulative_state(covid_states, state_population)
cumulativeUS <- cumulative_us(covid_states, united_states_pop)
```

```{r}
mapData <- cumulativeCounties
county <- map_data("county")
county$subregion <- replace(county$subregion, county$subregion == 'shannon', 'oglala lakota')
mapData$county.x <- tolower(mapData$county.x)
colnames(mapData)[colnames(mapData) == "county.x"] <- "subregion"
counties <- inner_join(county, mapData, by = "subregion")
```

```{r}
map_base <- ggplot(data = county, mapping = aes(x = long, y = lat, group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "black", fill = "gray") + 
  theme_minimal()
map_base 
```

```{r}
map <- map_base + 
  geom_polygon(data = counties, aes(fill = cases), color = "white") + 
  scale_fill_gradient(low = 'white', high = 'darkolivegreen4') 

map
```

```{r}
mapData <- cumulativeStates
state <- map_data("state")

mapData$state.x <- tolower(mapData$state.x)
colnames(mapData)[colnames(mapData) == "state.x"] <- "region"
states <- inner_join(state, mapData, by = "region")
```

```{r}
map_base <- ggplot(data = state, mapping = aes(x = long, y = lat, group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "black", fill = "gray") + 
  theme_minimal()
map_base 
```
```{r}
map <- map_base + 
  geom_polygon(data = states, aes(fill = cases), color = "white") + 
  scale_fill_gradient(low = "white", high = "darkolivegreen4")

map
```

